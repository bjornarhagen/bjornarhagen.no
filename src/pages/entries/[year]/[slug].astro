---
import ContentRenderer from "../../../components/dumb/ContentRenderer.astro";
import { entries } from "../../../data/entries";
import Layout from "../../../layouts/Layout.astro";
import { checkIfImageUrl } from "../../../utils/image";

export function getStaticPaths() {
    const paths = Object.keys(entries).flatMap((year) =>
        Object.keys(entries[year]).map((slug) => ({
            params: {
                year: year,
                slug: slug,
            },
        }))
    );
    console.log(`Generating pages for "entries/[year]/[slug]"`, { paths });
    return paths;
}

const { year, slug } = Astro.params;

const entry = entries[year][slug];
---

<Layout
    title={`${entry.title} | Posts`}
    description={entry.summary}
    image={entry.poster}
    marginForNav={false}
>
    <main class="relative max-w-full min-h-screen pt-16">
        <article>
            <header
                class="pt-16 flex flex-col gap-8 items-center relative w-full"
            >
                <div class="w-full max-w-screen-2xl mx-auto">
                    <div class="w-full px-4 lg:px-8 flex flex-col gap-4">
                        <div class="flex gap-1 font-sm opacity-50">
                            <a
                                class="hover:underline focus:underline"
                                href={`/entries`}>posts</a
                            >
                            <span>/</span>
                            <a
                                class="hover:underline focus:underline"
                                href={`/entries/${year}`}>{year}</a
                            >
                            <span>/</span>
                            <a
                                class="hover:underline focus:underline"
                                href={`/entries/${year}/${slug}`}>{slug}</a
                            >
                        </div>
                        <h1
                            class="flex flex-col lg:flex-row lg:gap-4 text-5xl sm:text-7xl font-heading leading-none text-left max-w-screen-lg"
                        >
                            <span>{entry.title}</span>
                        </h1>
                        <div class="grid md:grid-cols-4 gap-4">
                            <p class="col-span-4 md:col-span-2 font-light">
                                {entry.summary}
                            </p>
                            <div
                                class="col-span-2 flex flex-col gap-1 md:justify-self-end"
                            >
                                <p class="opacity-70">Dato</p>
                                <time class="font-bold">{entry.date}</time>
                            </div>
                        </div>
                    </div>
                </div>
                <img
                    src={checkIfImageUrl(entry.imageHeader)
                        ? entry.imageHeader
                        : "/images/loading-gray.svg"}
                    alt=`${entry.title}`
                    class="w-full px-4 pb-8 lg:px-8 lg:pb-16 max-w-screen-2xl"
                />
            </header>

            <ContentRenderer content={entry.content} />
        </article>
    </main>
</Layout>
