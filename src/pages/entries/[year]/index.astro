---
import ContentSection from "../../../components/dumb/ContentSection.astro";
import { entries } from "../../../data/entries";
import Layout from "../../../layouts/Layout.astro";

export function getStaticPaths() {
    const paths = Object.keys(entries).flatMap((year) =>
        Object.keys(entries[year]).map((slug) => ({
            params: {
                year: year,
                slug: slug,
            },
        }))
    );
    console.log(`Generating pages for "entries/[year]/[slug]"`, { paths });
    return paths;
}

const { year } = Astro.params;
---

<Layout title="Posts">
    <main class="pt-4">
        <ContentSection>
            <h1 class="font-heading text-6xl">
                <a href="/entries" class="hover:underline focus:underline"
                    >Posts</a
                > / {year}
            </h1>

            {
                Object.keys(entries).map((year) =>
                    Object.keys(entries[year]).map((slug) => {
                        const article = entries[year][slug];
                        return (
                            <article>
                                <a
                                    href={`/entries/${year}/${article.slug}`}
                                    class="flex flex-col gap-2 group"
                                >
                                    <p class="text-right opacity-70 font-light">
                                        {article.date}
                                    </p>
                                    <img
                                        src={article.poster}
                                        alt={article.title}
                                        class="w-full h-56 object-cover object-center rounded-lg group-hover:opacity-75 group-focus:opacity-75"
                                    />
                                    <div class="flex flex-col">
                                        <h2 class="font-bold font-paragraph text-2xl leading-none mt-1 mb-2 group-hover:underline group-focus:underline">
                                            {article.title}
                                        </h2>
                                        <p class="font-light opacity-90">
                                            {article.summary}
                                        </p>
                                    </div>
                                </a>
                            </article>
                        );
                    })
                )
            }
        </ContentSection>
    </main>
</Layout>
